# Tor obfs4 Bridge Configuration Example
# For helping censored users connect to the Tor network
# Bridges are NOT published in the main Tor directory

# ============================================================================
# REQUIRED: Basic Bridge Information
# ============================================================================

# Your bridge's nickname (alphanumeric, 1-19 characters)
Nickname MyTorBridge

# Contact information (email + optional PGP key)
ContactInfo your-email@example.com <0xYOUR_PGP_FINGERPRINT>

# ============================================================================
# REQUIRED: Network Configuration
# ============================================================================

# ORPort - The port for incoming Tor connections
# Common choices: 443, 9001, or any port > 1024
# Must be publicly accessible for bridge to work
ORPort 9001
ORPort [::]:9001

# ============================================================================
# REQUIRED: Bridge Mode
# ============================================================================

# Enable bridge relay mode
BridgeRelay 1

# Pluggable transport - obfs4 via lyrebird (obfuscates traffic to look like random data)
ServerTransportPlugin obfs4 exec /usr/bin/lyrebird
# obfs4 port - Common choices: 443, 9002, or any port > 1024 (different from ORPort)
# Must be publicly accessible for bridge to work
ServerTransportListenAddr obfs4 0.0.0.0:9002
ServerTransportListenAddr obfs4 [::]:9002

# Extended ORPort for pluggable transports
ExtORPort auto

# Publish bridge descriptor to bridge authority
PublishServerDescriptor 1

# ============================================================================
# REQUIRED: Data & Logging
# ============================================================================

# Where Tor stores its data (keys, state, etc.)
DataDirectory /var/lib/tor

# Log level and location (file + stdout for container logs)
Log notice file /var/log/tor/notices.log
Log notice stdout

# ============================================================================
# OPTIONAL: Control Port (Advanced Users Only)
# ============================================================================

# Uncomment if you want to install and use Nyx or other control tools
# Note: Nyx is NOT included in this image by default
# ControlPort 9051
# CookieAuthentication 1

# ============================================================================
# REQUIRED: Disable SOCKS
# ============================================================================

# Disable SOCKS proxy (we're a bridge, not a client)
SocksPort 0

# ============================================================================
# OPTIONAL: Bandwidth Limits
# ============================================================================

# Limit bandwidth to prevent overwhelming your connection
# Bridges can run on lower bandwidth than relays

# Average bandwidth (sustained rate)
RelayBandwidthRate 10 MBytes

# Burst bandwidth (temporary spikes)
RelayBandwidthBurst 20 MBytes

# Alternatively, use AccountingMax to limit monthly traffic:
# AccountingStart month 1 00:00
# AccountingMax 500 GB

# ============================================================================
# OPTIONAL: Performance Tuning
# ============================================================================

# Number of CPU cores to use
NumCPUs 2

# Maximum memory in queues
# MaxMemInQueues 512 MB

# ============================================================================
# Bridge Operation Notes
# ============================================================================

# 1. WHAT IS A BRIDGE?
#    - Bridges help users in censored countries connect to Tor
#    - Bridge addresses are NOT published in the main Tor directory
#    - They are distributed to users through BridgeDB and other means
#
# 2. obfs4 PLUGGABLE TRANSPORT
#    - Makes Tor traffic look like random data
#    - Harder for censors to detect and block
#    - Most effective transport for circumventing censorship
#
# 3. AFTER DEPLOYMENT
#    - Wait 24-48 hours for bridge to be published
#    - Check BridgeDB: https://bridges.torproject.org/
#    - Get your bridge line: docker exec <container> bridge-line
#
# 4. SHARING YOUR BRIDGE
#    - ONLY share your bridge line with people you trust
#    - Don't publish it publicly (defeats the purpose)
#    - Users can also get bridges from https://bridges.torproject.org/
#
# 5. MONITORING
#    - Check logs: docker logs <container>
#    - Full status: docker exec <container> status
#    - JSON health: docker exec <container> health
#    - Get bridge line: docker exec <container> bridge-line
#    - Bridges show fewer statistics than relays for privacy
#
# 6. PORTS TO EXPOSE
#    - ORPort (example: 9001, suggested: 443 or 9001) - Must be publicly accessible
#    - obfs4 port (example: 9002, can be any port) - Must be publicly accessible
#    - Firewall must allow both ports
#    - Using port 443 for ORPort may help with censorship circumvention
#
# 7. NETWORK CONSIDERATIONS
#    - Use a stable IP address
#    - Ensure both IPv4 and IPv6 work (if available)
#    - Test port accessibility from outside your network

# ============================================================================
# Deployment Example with Environment Variables
# ============================================================================
#
# Method 1: Using TOR_* naming (standard)
#
# docker run -d \
#   --name tor-bridge \
#   --network host \
#   -e TOR_RELAY_MODE=bridge \
#   -e TOR_NICKNAME=MyBridge \
#   -e TOR_CONTACT_INFO="your-email@example.com" \
#   -e TOR_ORPORT=9001 \
#   -e TOR_OBFS4_PORT=9002 \
#   -e TOR_BANDWIDTH_RATE="10 MBytes" \
#   -e TOR_BANDWIDTH_BURST="20 MBytes" \
#   -v tor-bridge-data:/var/lib/tor \
#   -v tor-bridge-logs:/var/log/tor \
#   ghcr.io/r3bo0tbx1/onion-relay:latest
#
# Method 2: Using official Tor Project naming (drop-in compatibility)
#
# docker run -d \
#   --name tor-bridge \
#   --network host \
#   -e NICKNAME=MyBridge \
#   -e EMAIL="your-email@example.com" \
#   -e OR_PORT=9001 \
#   -e PT_PORT=9002 \
#   -v tor-bridge-data:/var/lib/tor \
#   -v tor-bridge-logs:/var/log/tor \
#   ghcr.io/r3bo0tbx1/onion-relay:latest
#
# Note: PT_PORT automatically sets bridge mode. Both naming styles work identically.
#
# Get your bridge line after 24-48 hours:
# docker exec tor-bridge bridge-line
#
# Share the bridge line with users:
# Bridge obfs4 <IP>:<PORT> <FINGERPRINT> cert=<CERT> iat-mode=0

# ============================================================================
# Resources
# ============================================================================
#
# - Bridge Setup Guide: https://community.torproject.org/relay/setup/bridge/
# - BridgeDB: https://bridges.torproject.org/
# - Pluggable Transports: https://tb-manual.torproject.org/circumvention/
# - obfs4 Spec: https://gitlab.com/yawning/obfs4
