# Tor Exit Relay Configuration Example
# ⚠️  WARNING: Running an exit relay has legal implications!
# Read https://community.torproject.org/relay/community-resources/eff-tor-legal-faq/
# before deploying.

# ============================================================================
# REQUIRED: Basic Relay Information
# ============================================================================

# Your relay's nickname (alphanumeric, 1-19 characters)
Nickname MyTorExitRelay

# Contact information (email + optional PGP key)
# This is CRITICAL for exit relays - you WILL receive abuse complaints
ContactInfo your-email@example.com <0xYOUR_PGP_FINGERPRINT>

# ============================================================================
# REQUIRED: Network Configuration
# ============================================================================

# ORPort - The port for incoming Tor connections
# Common choices: 443, 9001, or any port > 1024
ORPort 9001
ORPort [::]:9001

# DirPort - Directory information port (optional but recommended)
# Common choices: 80, 9030, or any port > 1024
# Set to 0 to disable directory serving
DirPort 9030

# ============================================================================
# REQUIRED: Exit Relay Configuration
# ============================================================================

# Enable exit relay mode
ExitRelay 1

# Exit policy - REDUCED EXIT POLICY (recommended for new operators)
# This allows common services while blocking high-risk ports
# See: https://trac.torproject.org/projects/tor/wiki/doc/ReducedExitPolicy

ExitPolicy accept *:20-21     # FTP
ExitPolicy accept *:22        # SSH
ExitPolicy accept *:43        # WHOIS
ExitPolicy accept *:53        # DNS
ExitPolicy accept *:79-81     # finger, HTTP
ExitPolicy accept *:88        # kerberos
ExitPolicy accept *:110       # POP3
ExitPolicy accept *:143       # IMAP
ExitPolicy accept *:194       # IRC
ExitPolicy accept *:220       # IMAP3
ExitPolicy accept *:389       # LDAP
ExitPolicy accept *:443       # HTTPS
ExitPolicy accept *:464       # kpasswd
ExitPolicy accept *:465       # SMTP over SSL
ExitPolicy accept *:531       # IRC/AIM
ExitPolicy accept *:543-544   # Kerberos
ExitPolicy accept *:554       # RTSP
ExitPolicy accept *:563       # NNTP over SSL
ExitPolicy accept *:587       # SMTP
ExitPolicy accept *:636       # LDAP over SSL
ExitPolicy accept *:706       # SILC
ExitPolicy accept *:749       # kerberos
ExitPolicy accept *:873       # rsync
ExitPolicy accept *:902-904   # VMware
ExitPolicy accept *:981       # HTTPS
ExitPolicy accept *:989-990   # FTP over SSL
ExitPolicy accept *:991       # NAS
ExitPolicy accept *:992       # Telnet over SSL
ExitPolicy accept *:993       # IMAP over SSL
ExitPolicy accept *:994       # IRC over SSL
ExitPolicy accept *:995       # POP3 over SSL
ExitPolicy accept *:1194      # OpenVPN
ExitPolicy accept *:1220      # QT Server Admin
ExitPolicy accept *:1293      # IPSec
ExitPolicy accept *:1500      # VLSI
ExitPolicy accept *:1533      # Sametime
ExitPolicy accept *:1677      # GroupWise
ExitPolicy accept *:1723      # PPTP
ExitPolicy accept *:1755      # RTSP
ExitPolicy accept *:1863      # MSNP
ExitPolicy accept *:2082      # Infowave
ExitPolicy accept *:2083      # Secure Radius
ExitPolicy accept *:2086-2087 # GNUnet
ExitPolicy accept *:2095-2096 # NBX
ExitPolicy accept *:2102-2104 # Zephyr
ExitPolicy accept *:3128      # SQUID
ExitPolicy accept *:3389      # RDP
ExitPolicy accept *:3690      # SVN
ExitPolicy accept *:4321      # RWHOIS
ExitPolicy accept *:4643      # Virtuozzo
ExitPolicy accept *:5050      # Yahoo! Messenger
ExitPolicy accept *:5190      # AIM/ICQ
ExitPolicy accept *:5222-5223 # XMPP, XMPP over SSL
ExitPolicy accept *:5228      # Google Play
ExitPolicy accept *:5900      # VNC
ExitPolicy accept *:6660-6669 # IRC
ExitPolicy accept *:6679      # IRC SSL
ExitPolicy accept *:6697      # IRC SSL
ExitPolicy accept *:8000      # iRDMI
ExitPolicy accept *:8008      # HTTP alternate
ExitPolicy accept *:8074      # Gadu-Gadu
ExitPolicy accept *:8080      # HTTP Proxies
ExitPolicy accept *:8082      # HTTPS Electrum Bitcoin port
ExitPolicy accept *:8087-8088 # Simplify Media SPP Protocol, Radan HTTP
ExitPolicy accept *:8232-8233 # Zcash
ExitPolicy accept *:8332-8333 # Bitcoin
ExitPolicy accept *:8443      # PCsync HTTPS
ExitPolicy accept *:8888      # HTTP Proxies, NewsEDGE
ExitPolicy accept *:9418      # git
ExitPolicy accept *:9999      # distinct
ExitPolicy accept *:10000     # Network Data Management Protocol
ExitPolicy accept *:11371     # OpenPGP hkp (keyserver)
ExitPolicy accept *:19294     # Google Voice TCP
ExitPolicy accept *:19638     # Ensim Control Panel
ExitPolicy accept *:50002     # Electrum Bitcoin SSL
ExitPolicy accept *:64738     # Mumble
ExitPolicy reject *:*         # reject everything else

# Alternative: More restrictive (HTTP/HTTPS only)
# ExitPolicy accept *:80      # HTTP
# ExitPolicy accept *:443     # HTTPS
# ExitPolicy reject *:*       # reject everything else

# ============================================================================
# REQUIRED: Data & Logging
# ============================================================================

# Where Tor stores its data (keys, state, etc.)
DataDirectory /var/lib/tor

# Log level and location (file + stdout for container logs)
Log notice file /var/log/tor/notices.log
Log notice stdout

# ControlPort for monitoring with Nyx
ControlPort 9051
CookieAuthentication 1

# ============================================================================
# REQUIRED: Disable SOCKS
# ============================================================================

# Disable SOCKS proxy (we're a relay, not a client)
SocksPort 0

# ============================================================================
# OPTIONAL: Bandwidth Limits
# ============================================================================

# Limit bandwidth to prevent overwhelming your connection
# Exit relays typically need MORE bandwidth than guard relays

# Option 1: Relay-specific bandwidth (recommended for exit relays)
# Average bandwidth (sustained rate)
RelayBandwidthRate 50 MBytes

# Burst bandwidth (temporary spikes)
RelayBandwidthBurst 100 MBytes

# Option 2: Global bandwidth limits (applies to all Tor traffic)
# BandwidthRate 50 MBytes
# BandwidthBurst 100 MBytes

# Note: Use RelayBandwidthRate/Burst for exit relays to avoid limiting
# directory and other non-relay traffic. Use BandwidthRate/Burst if you
# want to limit ALL Tor traffic including directory requests.

# Alternatively, use AccountingMax to limit monthly traffic:
# AccountingStart month 1 00:00
# AccountingMax 1000 GB

# ============================================================================
# OPTIONAL: Performance Tuning
# ============================================================================

# Number of CPU cores to use
NumCPUs 2

# Maximum memory in queues
# MaxMemInQueues 1024 MB

# ============================================================================
# IMPORTANT: Exit Relay Legal Considerations
# ============================================================================

# 1. UNDERSTAND THE LEGAL RISKS
#    - Your IP will be associated with exit traffic
#    - You WILL receive abuse complaints
#    - Some services may block your IP
#    - Legal liability varies by jurisdiction
#
# 2. PREPARATION CHECKLIST
#    ✓ Read EFF Tor Legal FAQ
#    ✓ Inform your ISP (recommended)
#    ✓ Set up abuse complaint handling
#    ✓ Use a dedicated IP/server
#    ✓ Consider running from a datacenter
#    ✓ Have legal resources available
#    ✓ Set up WHOIS with your contact info
#    ✓ Create abuse@ email address
#
# 3. ABUSE RESPONSE TEMPLATE
#    Keep a standard response ready:
#    "This is a Tor exit relay. The IP address you reported
#    is not the source of malicious activity. Tor is an
#    anonymity network. Please see https://www.torproject.org/
#    for more information."
#
# 4. MONITORING
#    - Check status daily: docker exec <container> status
#    - Get JSON health: docker exec <container> health
#    - View logs: docker logs <container>
#    - Set up alerts for issues
#
# 5. RESOURCES
#    - Tor Legal FAQ: https://community.torproject.org/relay/community-resources/eff-tor-legal-faq/
#    - Abuse Response: https://community.torproject.org/relay/community-resources/tor-abuse-templates/
#    - Good/Bad ISPs: https://community.torproject.org/relay/community-resources/good-bad-isps/

# ============================================================================
# Deployment Example with Environment Variables
# ============================================================================
#
# Instead of mounting this file, you can use environment variables:
#
# docker run -d \
#   --name tor-exit-relay \
#   --network host \
#   -e TOR_RELAY_MODE=exit \
#   -e TOR_NICKNAME=MyExitRelay \
#   -e TOR_CONTACT_INFO="your-email@example.com" \
#   -e TOR_ORPORT=9001 \
#   -e TOR_DIRPORT=9030 \
#   -e TOR_BANDWIDTH_RATE="50 MBytes" \
#   -e TOR_BANDWIDTH_BURST="100 MBytes" \
#   -e TOR_EXIT_POLICY="accept *:80,accept *:443,reject *:*" \
#   -v tor-exit-data:/var/lib/tor \
#   -v tor-exit-logs:/var/log/tor \
#   ghcr.io/r3bo0tbx1/onion-relay:latest
