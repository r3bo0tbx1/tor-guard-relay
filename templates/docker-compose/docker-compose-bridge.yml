version: '3.8'

services:
  tor-bridge:
    image: r3bo0tbx1/onion-relay:latest
    container_name: tor-bridge
    restart: unless-stopped
    network_mode: host
    environment:
      TOR_RELAY_MODE: bridge
      TOR_NICKNAME: MyTorBridge
      TOR_CONTACT_INFO: "your-email@example.com"
      TOR_ORPORT: 9001
      TOR_OBFS4_PORT: 9002
      TOR_BANDWIDTH_RATE: "10 MBytes"
      TOR_BANDWIDTH_BURST: "20 MBytes"
    volumes:
      - tor-bridge-data:/var/lib/tor
      - tor-bridge-logs:/var/log/tor
    security_opt:
      - no-new-privileges:true
    cap_add:
      - NET_BIND_SERVICE
      - CHOWN
      - SETUID
      - SETGID
      - DAC_OVERRIDE
    cap_drop:
      - ALL
    healthcheck:
      test: ["CMD-SHELL", "/usr/local/bin/healthcheck.sh"]
      interval: 10m
      timeout: 15s
      start_period: 30s
      retries: 3
    labels:
      com.centurylinklabs.watchtower.enable: "true"
      description: "Tor obfs4 Bridge"
      version: "1.1.6"
      maintainer: "rE-Bo0t.bx1 <r3bo0tbx1@brokenbotnet.com>"

volumes:
  tor-bridge-data:
    driver: local
  tor-bridge-logs:
    driver: local