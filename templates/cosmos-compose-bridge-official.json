{
  "minVersion": "0.8.0",
  "services": {
    "obfs4-bridge": {
      "image": "ghcr.io/r3bo0tbx1/onion-relay:latest",
      "container_name": "obfs4-bridge",
      "restart": "unless-stopped",
      "network_mode": "host",
      "environment": [
        "OR_PORT=9001",
        "PT_PORT=9002",
        "EMAIL=admin@example.com",
        "NICKNAME=MyObfs4Bridge"
      ],
      "volumes": [
        {
          "type": "volume",
          "source": "obfs4-data",
          "target": "/var/lib/tor"
        },
        {
          "type": "volume",
          "source": "obfs4-logs",
          "target": "/var/log/tor"
        }
      ],
      "security_opt": ["no-new-privileges:true"],
      "cap_drop": ["ALL"],
      "cap_add": [
        "NET_BIND_SERVICE",
        "CHOWN",
        "SETUID",
        "SETGID",
        "DAC_OVERRIDE"
      ],
      "labels": {
        "cosmos-stack": "TorBridge",
        "cosmos-stack-main": "obfs4-bridge",
        "cosmos-description": "ðŸŒ‰ Tor obfs4 Bridge - Drop-in replacement for thetorproject/obfs4-bridge | Official ENV naming | Weekly security updates",
        "cosmos-icon": "https://raw.githubusercontent.com/r3bo0tbx1/tor-guard-relay/refs/heads/main/src/obfs4.png",
        "cosmos-auto-update": "true",
        "cosmos-auto-update-type": "registry",
        "cosmos-force-network-secured": "false",
        "cosmos-auto-update-notify": "true",
        "cosmos-auto-update-restart": "true",
        "cosmos-version": "1.1.1",
        "maintainer": "rE-Bo0t.bx1 <r3bo0tbx1@brokenbotnet.com>"
      }
    }
  },
  "volumes": {
    "obfs4-data": {},
    "obfs4-logs": {}
  },
  "metadata": {
    "description": "ðŸŒ‰ Tor obfs4 Bridge - Drop-in replacement for thetorproject/obfs4-bridge with official ENV naming",
    "version": "1.1.1",
    "author": "r3bo0tbx1",
    "tags": ["tor", "bridge", "obfs4", "censorship", "pluggable-transport", "official-compatible"],
    "configuration_method": "environment_variables",
    "compatibility": "thetorproject/obfs4-bridge",
    "notes": [
      "Drop-in replacement for thetorproject/obfs4-bridge with official ENV naming",
      "Minimal required: OR_PORT, PT_PORT, EMAIL, NICKNAME",
      "Auto-detects bridge mode when PT_PORT is set",
      "For advanced torrc options, enable: OBFS4_ENABLE_ADDITIONAL_VARIABLES=1",
      "Then add OBFS4V_* variables (e.g., OBFS4V_AddressDisableIPv6=0)",
      "For mounted config file, remove environment variables and add:",
      "  { \"type\": \"bind\", \"source\": \"/path/to/relay-bridge.conf\", \"target\": \"/etc/tor/torrc\", \"read_only\": true }",
      "After deployment: docker exec obfs4-bridge bridge-line",
      "Weekly security rebuilds every Sunday 18:30 UTC"
    ],
    "migration_from_official": {
      "step1": "Preserve your volumes: obfs4-data contains bridge identity",
      "step2": "Stop old container: docker stop obfs4-bridge",
      "step3": "Fix ownership if migrating from Debian: docker run --rm -v obfs4-data:/data alpine:3.22.2 chown -R 100:101 /data",
      "step4": "Deploy this template with same volume name",
      "step5": "Verify fingerprint unchanged: docker exec obfs4-bridge fingerprint"
    }
  }
}
